apiVersion: 1.0.0
kind: AssuranceProcedure
procedure:
  nrn: "nrn:procedure:rover-medical/rover-medicine-system"
  short: "Rover Medical System - Verification Procedure"
  description: |
    "Verifies the configutation and communcations between the Pet Medicine Application and it's database."
activity:
  - name: pet-medicine-app
    short: "Pet Medicine Application Configuration"
    description: |
      "Verify the Pet Medicine Application has the required configuration settings to
      ensure security and operational resilence control standards are met."
    action:
      - name: database-connection
        short: "Database Connection String"
        description: "The application connects to the databse at network location 'db://pet-medicine-db/prescriptions'."
        test: "activity/pet-medicine-app/database-connection.py"
        evidence: "evidence/pet-medicine-app/app-config.toml"
      - name: database-user
        short: "Database User"
        description: "The applicaiton authenticates with the database user of 'Pet_Medicine_App'."
        test: "activity/pet-medicine-app/database-user.py"
        evidence: "evidence/pet-medicine-app/app-config.toml"
      - name: database-user-secret
        short: "Database User Secret String"
        description: "The application retrieves the database users credentials from the secrets store 'secrets://vault/prod/pet_medicine_app_db_user'."
        test: "activity/pet-medicine-app/database-user-secret.py"
        evidence: "evidence/pet-medicine-app/app-config.toml"
      - name: enforce-https
        short: "Enforce HTTPS"
        description: "The applicaiton enforces the use of HTTPS when communicating with clients."
        test: "activity/pet-medicine-app/enforce-https.py"
        evidence: "evidence/pet-medicine-app/app-config.toml"
      - name: app-tls-configured
        short: "Application TLS Configured"
        description: "The applicaiton is configured for production using the properly public key, private key, and trusted certificate bundle."
        test: "activity/pet-medicine-app/app-tls-configured.py"
        evidence: "evidence/pet-medicine-app/app-config.toml"
  - name: pet-medicine-db
    short: "Pet Medicine Database Configuration"
    description: |
      "Verify the Pet Medicine Database configuration has the required settings to
      ensure security and operational resilence control standards are met."
    action:
      - name: database-host-user
        short: "Database Host User"
        description: "The database operates under host user account 'pet-med-db'."
        test: "activity/pet-medicine-db/database-host-user.py"
        evidence: "evidence/pet-medicine-db/my-db.ini"
      - name: database-port
        short: "Database Port"
        description: "The database communicates from port '3306'."
        test: "activity/pet-medicine-db/database-port.py"
        evidence: "evidence/pet-medicine-db/my-db.ini"
      - name: enforce-tls
        short: "Enforce TLS"
        description: "The database requires TLS for all TCP connections."
        test: "activity/pet-medicine-db/enforce-tls.py"
        evidence: "evidence/pet-medicine-db/my-db.ini"
      - name: database-tls-configured
        short: "Current TLS Certificate"
        description: "The database is configured for production using the proper public key, private key, and trusted certificate bundle."
        test: "activity/pet-medicine-db/database-tls-configured.py"
        evidence: "evidence/pet-medicine-db/my-db.ini"
  - name: pet-medicine-host
    short: "Pet Medicine Host"
    description: |
      "Verify the Pet Medicine Host which acts as the server for the Pet Medicine Application and it's database
      configis propelry configured to ensure security and operational resilence control standards are met."
    action:
      - name: app-user-exists
        short: "Application User Exists"
        description: "The application only operates under user account 'pet-med-app'."
        test: "activity/pet-medicine-host/app-user-exists.py"
        evidence: "evidence/pet-medicine-host/stdout-user-exists-app-user.txt"
      - name: db-user-exists
        short: "Database Host User"
        description: "The database only operates under the user account 'pet-med-db'."
        test: "activity/pet-medicine-host/db-user-exists.py"
        evidence: "evidence/pet-medicine-host/stdout-user-exists-db-user.txt"

      - name: db-user-no-login
        short: "Database  User Cannot Loging"
        description: "The user account 'pet-med-db' is not configured to login into the host."
        test: "activity/pet-medicine-host/db-user-no-login.py"
        evidence: "evidence/pet-medicine-host/stdout-no-login-db-user.txt"
      - name: app-user-no-login
        short: "Application User Cannot Login"
        description: "The user account 'pet-med-app' is not configured to login into the host."
        test: "activity/pet-medicine-host/app-user-no-login.py"
        evidence: "evidence/pet-medicine-host/stdout-no-login-app-user.txt"

      - name: admin-user-not-root
        short: "Admin User not Root"
        description: "The admin user account 'pet-med-admin' is not configured as a root user."
        test: "activity/pet-medicine-host/admin-user-not-root.py"
        evidence: "evidence/pet-medicine-host/stdout-root-check-admin-user.txt"
      - name: app-user-not-root
        short: "Application User not Root"
        description: "The user account 'pet-med-app' is not configured as a root user."
        test: "activity/pet-medicine-host/app-user-not-root.py"
        evidence: "evidence/pet-medicine-host/stdout-root-check-app-user.txt"
      - name: db-user-not-root
        short: "Database User not Root"
        description: "The user account 'pet-med-db' is not configured as a root user."
        test: "activity/pet-medicine-host/db-user-not-root.py"
        evidence: "evidence/pet-medicine-host/stdout-root-check-db-user.txt"

      - name: auditctl-installed
        short: "AuditCtl Installed"
        description: "The AuditCtl is installed and operational on the host."
        test: "activity/pet-medicine-host/auditctl-installed.py"
        evidence: "evidence/pet-medicine-host/stdout-auditctl-installed.txt"
      - name: auditctl-user-commands-logged
        short: "AuditCtl Logging All User Commands"
        description: "The AuditCtl is properly configured to log every users' commands on the host."
        test: "activity/pet-medicine-host/auditctl-user-commands-logged.py"
        evidence: "evidence/pet-medicine-host/stdout-auditctl-user-commands-logged.txt"

  - name: rover-cloud
    short: "Rover Cloud"
    description: |
      "Verify the Rover Cloud is propelry configured to ensure security and operational resilence control standards are met."
    action:
      - name: dmz-exists
        short: "DMZ Exists"
        description: "The DMZ is configured correctly for Rover Cloud."
        test: "activity/rover-cloud/dmz-exists.py"
        evidence: "evidence/rover-cloud/cloud-config.yaml"
      - name: intrusion-detection-enabled
        short: "Intrusion Detection is Enabled"
        description: "The provided Intrusion Dection system is enabled for Rover Cloud."
        test: "activity/rover-cloud/intrusion_detection_enabled.py"
        evidence: "evidence/rover-cloud/cloud-config.yaml"

  - name: exa-doo-dc
    short: "Exa-Doo Datacenter"
    description: |
      "Verify all Rover Medical Third-Party (3rd) Risk assessments and formal attestations for the Exa-Doo Data Center have been completed."
    action:
      - name: current-soc1
        short: "Current SOC1"
        description: "Exa-Doo Datacenter's SOC1 Type II Report has been issued within the past 18 months."
        test: "activity/exa-doo-dc/current-soc1.py"
        evidence: "evidence/exa-doo-dc/soc1-report-analysis.json"
      - name: soc1-within-expiry
        short: "SOC1 Within Expiration"
        description: "Exa-Doo Datacenterâ€™s SOC 1 Type II report has more than 90 days before it reaches 18 months old."
        test: "activity/exa-doo-dc/soc1-within-expiry.py"
        evidence: "evidence/exa-doo-dc/soc1-report-analysis.json"